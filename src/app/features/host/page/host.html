<div class="host-screen">

  <!-- ======= HEADER / SESSION ======= -->
  <header class="host-header">
    <div class="host-header__left">
      <h1 class="host-title">–ï–∫—Ä–∞–Ω –≤–µ–¥—É—á–æ–≥–æ</h1>
      <p class="host-session">
        –°–µ—Å—ñ—è:
        <span class="host-session__id">{{ sessionId || '---' }}</span>
      </p>
    </div>

    <div class="host-header__right">
      @if (gameState(); as s) {
        <div class="host-status" [class.host-status--running]="s?.running">
          <span>–•—ñ–¥: <b>{{ s?.activePlayer || '‚Äî' }}</b></span>
          <span class="dot" [class.blink]="s?.running"></span>
        </div>
      } @else {
        <div class="host-status host-status--muted">
          –û—á—ñ–∫—É—î–º–æ —Å—Ç–∞–Ω –≥—Ä–∏...
        </div>
      }
    </div>
  </header>

  <!-- ======= TOPIC SELECTOR ======= -->
  <section class="host-topics">
    <h2 class="section-title">–¢–µ–º–∞</h2>

    @if (topics().length) {
      <div class="topics-list">
        @for (topic of topics(); track topic.id) {
          <button
            type="button"
            class="topic-chip"
            [class.topic-chip--active]="selectedTopic()?.id === topic.id"
            (click)="chooseTopic(topic)"
          >
            {{ topic.name }}
          </button>
        }
      </div>
    } @else {
      <p class="muted">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–µ–º...</p>
    }
  </section>

  <!-- ======= MAIN LAYOUT ======= -->
  <main class="host-layout">

    <!-- === LEFT: IMAGE STAGE === -->
    <section class="host-main">
      <h2 class="section-title">–ö–∞—Ä—Ç–∏–Ω–∫–∞</h2>

      @if (gameState(); as s) {

        <div class="stage" [class.placeholder]="!s?.images?.length">
          @if (s?.images?.length) {
            <img
              [src]="s?.images?.[s.imageIndex]?.src"
              [alt]="s?.images?.[s.imageIndex]?.alt"
            />
          } @else {
            <!-- –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä —Ç–µ–∫—Å—Ç –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ CSS -->
          }
        </div>

        <div class="image-meta">
          <div class="image-meta__row">
            <span>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è:</span>
            <b>
              {{ (s?.imageIndex ?? 0) + 1 }}/{{ s?.images?.length ?? 0 }}
            </b>
          </div>

          <div class="image-meta__row image-meta__row--alt">
            <span>Alt:</span>
            <span class="image-alt">
              {{ s?.images?.[s.imageIndex]?.alt || '‚Äî (alt –Ω–µ –∑–∞–¥–∞–Ω–æ)' }}
            </span>
          </div>
        </div>

      } @else {
        <div class="stage placeholder"></div>
        <p class="muted">–û—á—ñ–∫—É—î–º–æ —Å—Ç–∞–Ω –≥—Ä–∏...</p>
      }

    </section>

    <!-- === RIGHT: CONTROLS + TIMERS === -->
    <aside class="host-sidebar">

      <!-- TIMERS -->
      <section class="host-timers">
        <h2 class="section-title">–¢–∞–π–º–µ—Ä–∏</h2>

        @if (gameState(); as s) {
          <div class="players">

            <div class="player" [class.active]="s?.activePlayer === 'A'">
              <span class="label">A</span>
              <span class="time">{{ s?.timeA }}s</span>
            </div>

            <div class="status" [class.ended]="s?.timeA === 0 || s?.timeB === 0">

              @if (s?.timeA === 0 || s?.timeB === 0) {
                <span class="result">
                  –ü–µ—Ä–µ–º–æ–∂–µ—Ü—å:
                  <b>
                    {{
                      s?.timeA === 0 && s?.timeB > 0
                        ? 'B'
                        : s?.timeB === 0 && s?.timeA > 0
                          ? 'A'
                          : '–ù—ñ—á–∏—è'
                    }}
                  </b>
                </span>
              } @else {
                <span>–•—ñ–¥: {{ s?.activePlayer || '‚Äî' }}</span>
                <span class="dot" [class.blink]="s?.running"></span>
              }

            </div>

            <div class="player" [class.active]="s?.activePlayer === 'B'">
              <span class="label">B</span>
              <span class="time">{{ s?.timeB }}s</span>
            </div>

          </div>
        } @else {
          <p class="muted">–¢–∞–π–º–µ—Ä–∏ –±—É–¥—É—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ñ –ø—ñ—Å–ª—è —Å—Ç–∞—Ä—Ç—É –≥—Ä–∏.</p>
        }

      </section>

      <!-- CONTROLS -->
      <section class="host-controls">
        <h2 class="section-title">–ö–µ—Ä—É–≤–∞–Ω–Ω—è</h2>

        <div class="controls-grid">
          <button type="button" class="btn btn--primary" (click)="start('A')">
            ‚ñ∂ –°—Ç–∞—Ä—Ç A
          </button>

          <button type="button" class="btn btn--primary" (click)="start('B')">
            ‚ñ∂ –°—Ç–∞—Ä—Ç B
          </button>

          <button type="button" class="btn btn--success" (click)="correct()">
            ‚úì Correct
          </button>

          <button type="button" class="btn btn--danger" (click)="wrong()">
            ‚úó Wrong (-3 —Å–µ–∫)
          </button>

          <button type="button" class="btn btn--secondary" (click)="pause()">
            ‚è∏ –ü–∞—É–∑–∞
          </button>
          <button
            type="button"
            class="btn btn--ghost full-width"
            (click)="resetTimers()"
          >
            üîÑ –°–∫–∏–Ω—É—Ç–∏ —á–∞—Å
          </button>
        </div>
      </section>

    </aside>

  </main>

</div>
